#### Flask 邮件(Flask-Mail)

基于web的应用程序通常需要具有向用户/客户端发送邮件的功能。

**Flask-Mail**扩展使得与任何电子邮件服务器建立简单的接口变得非常容易。

首先，应该在pip实用程序的帮助下安装Flask-Mail扩展。

```python3
pip install Flask-Mail
```

然后需要通过设置以下应用程序参数的值来配置Flask-Mail。

| 序号 | 参数与描述                                                   |
| :--- | :----------------------------------------------------------- |
| 1    | **MAIL_SERVER**电子邮件服务器的名称/IP地址                   |
| 2    | **MAIL_PORT**使用的服务器的端口号                            |
| 3    | **MAIL_USE_TLS**启用/禁用传输安全层加密                      |
| 4    | **MAIL_USE_SSL**启用/禁用安全套接字层加密                    |
| 5    | **MAIL_DEBUG**调试支持。默认值是Flask应用程序的调试状态      |
| 6    | **MAIL_USERNAME**发件人的用户名                              |
| 7    | **MAIL_PASSWORD**发件人的密码                                |
| 8    | **MAIL_DEFAULT_SENDER**设置默认发件人                        |
| 9    | **MAIL_MAX_EMAILS**设置要发送的最大邮件数                    |
| 10   | **MAIL_SUPPRESS_SEND**如果app.testing设置为true，则发送被抑制 |
| 11   | **MAIL_ASCII_ATTACHMENTS**如果设置为true，则附加的文件名将转换为ASCII |

flask-mail模块包含以下重要类的定义。

## 



#### Mail类

它管理电子邮件消息传递需求。类构造函数采用以下形式：

```python3
flask-mail.Mail(app = None)
```

构造函数将Flask应用程序对象作为参数。



#### Mail类的方法

| 序号 | 方法与描述                        |
| :--- | :-------------------------------- |
| 1    | **send()**发送Message类对象的内容 |
| 2    | **connect()**打开与邮件主机的连接 |
| 3    | **send_message()**发送消息对象    |

## 

#### Message类

它封装了一封电子邮件。Message类构造函数有几个参数:

```python3
flask-mail.Message(subject, recipients, body, html, sender, cc, bcc, 
   reply-to, date, charset, extra_headers, mail_options, rcpt_options)
```



#### Message类方法

**attach()** - 为邮件添加附件。此方法采用以下参数：

- **filename** - 要附加的文件的名称
- **content_type** - MIME类型的文件
- **data** - 原始文件数据
- **处置** - 内容处置（如果有的话）。

**add_recipient()** - 向邮件添加另一个收件人



在下面的示例中，Google gmail服务的SMTP服务器用作Flask-Mail配置的MAIL_SERVER。

**步骤1** - 在代码中从flask-mail模块导入Mail和Message类。

```python3
from flask_mail import Mail, Message
```



**步骤2** - 然后按照以下设置配置Flask-Mail。

```python3
app.config['MAIL_SERVER']='smtp.gmail.com'
app.config['MAIL_PORT'] = 465
app.config['MAIL_USERNAME'] = 'yourId@gmail.com'
app.config['MAIL_PASSWORD'] = '*****'
app.config['MAIL_USE_TLS'] = False
app.config['MAIL_USE_SSL'] = True
```



**步骤3** - 创建Mail类的实例。

```python3
mail = Mail(app)
```



**步骤4** - 在由URL规则**（‘/’）**映射的Python函数中设置Message对象。

```python3
@app.route("/")
def index():
   msg = Message('Hello', sender = 'yourId@gmail.com', recipients = ['id1@gmail.com'])
   msg.body = "This is the email body"
   mail.send(msg)
   return "Sent"
```



**步骤5** - 整个代码如下。

在Python Shell中运行以下脚本并访问**http://localhost:5000/。**

```python3
from flask import Flask
from flask_mail import Mail, Message

app = Flask(__name__)
#静态资源
app.config['UPLOAD_FOLDER'] = 'static/'

#邮件
app.config['MAIL_SERVER']='smtp.163.com'
app.config['MAIL_PORT'] = 465
app.config['MAIL_USERNAME'] = 'linglonglion@163.com'
app.config['MAIL_PASSWORD'] = 'TJYUGQREASBPMTQO'
app.config['MAIL_USE_TLS'] = False
app.config['MAIL_USE_SSL'] = True
mail = Mail(app)


@app.route('/')
def index():
   msg = Message('Hello', sender = app.config['MAIL_USERNAME'], recipients = ['2522908520@qq.com'])
   msg.body = "Hello Flask message sent from Flask-Mail"
   mail.send(msg)
   return "Sent"

if __name__ == '__main__':
   app.run(debug = True)
```

