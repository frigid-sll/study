#### docker搭建的直接在设置的目录中创建即可，下面的用不到



> 📝**有关用语**
>
> 会交叉使用插件(**add-on**)、模块(**module**)、应用(**app**)或插件模块(**add-on module**)。它们都是指可通过用户界面在Odoo中安装的Odoo应用或扩展应用。



##### 配置插件路径

通过**addons_path**参数的配置，可以在 Odoo 中加载自己的插件模块。在Odoo初始化一个新数据库时，它会在addons_path配置参数中给定的这些目录中搜索插件模块。addons_path会在这些目录中搜索潜在的插件模块。



addons_path中所列出的目录预期应包含子目录，每个子目录是一个插件模块。在数据库初始化完成后，将能够安装这些目录中所给出的模块。



##### 默认启动

```
python3 odoo-bin --addons-path=addons -d 库名 -i base
```



##### my-instance.cfg修改该行，添加一个逗号（英文半角），并接你想要添加为addons_path的目录名称，如以下代码所示：

```
addons_path = ~/odoo-dev/odoo/addons,~/odoo-dev/local-addons
```

##### 用配置文件启动

```
~/odoo-dev/odoo/odoo-bin -c my-instance.cfg
```



##### 运行原理…

- 在重启 Odoo 时，会读取配置文件。
- addons_path变量的值应为一个逗号分隔的目录列表。
- 可接受相对路径，但它们是相对于当前工作目录的，因此应在配置文件中**尽量避免**。



至此，我们仅在Odoo中列出了插件目录，但~/odoo-dev/local-addons中尚不存在插件模块。

即使在该目录中新增了插件模块，Odoo也**不会在用户界面中显示这一模块**。为此，你需要执行一个额外的操作，在下一部分*更新插件模块列表*中会进行讲解。

📝这背后的原因是在初始化新数据库时，Odoo在可用模块中自动列举了自定义模块，但如若在数据库初始化之后新增模块，就需要像*更新插件模块列表*一节中那样手动更新可用模块列表。

##### 扩展知识…

在首次调用 odoo-bin脚本来初始化新数据库时，可以传递一个带逗号分隔目录列表的–addons-path命令行参数。这会以所提供插件路径中所找到的所有插件来初始化可用插件模块列表。这么做时，要显式地包含基础插件目录（odoo/odoo/addons）以及核心插件目录（odoo/addons）。与前面稍有不同的是本地插件目录不能为空（**译者注：**请先阅读下面的小贴士），它必须要**至少包含一个子目录，并包含插件模块的最小化结构**。



在[第三章 创建Odoo插件模块](https://alanhou.org/odoo-14-creating-odoo-add-on-modules/)中，我们会来看如何编写你自己的模块。同时，这里有一个生成内容来满足Odoo要求的快捷版黑科技：

```
mkdir -p ./local-addons/dummy
touch ./local-addons/dummy/__init__.py
echo '{"name": "dummy", "installable": False}' >./local-addons/dummy/__manifest__.py


cat ~/odoo-dev/local-addons/dummy/__manifest__.py
{"name": "dummy", "installable": False}
```



你可以使用–save选项来保存路径至配置文件中：

```
./odoo-bin -d pert --addons-path="addons,local-addons" --save -c odoo.conf --stop-after-init
```

- -d：指定数据库
- --addons-path：指定插件目录，逗号分隔
- --save：启动服务后生成配置文件：odoo.conf
- --stop-after-init：完成后停止服务，不启动



本例中，使用相对路径不会有问题，因为它们会在配置文件中转化为绝对路径。

> **📝注：**因为Odoo仅当从命令行中设置路径时在插件路径的目录中查看插件，而不是在从配置文件中加载路径的时候，dummy已不再必要。因此，你可以删除它（或保留到你确定不需要新建一个配置文件时）。





##### 标准化你的实例目录布局

我们推荐你在开发和生产环境都使用相似的目录布局。这一标准化会在你要执行运维时体现出用处，它也会缓解你日常工作的压力。

这一部分创建将相似生命周期或相似用途的文件分组放在标准化子目录中的目录结构。



##### 如何标准化…

创建所推荐实例布局，需要执行如下步骤：

- 为每个实例创建一个目录：

  ```
  $ mkdir ~/odoo-dev/projectname
  $ cd ~/odoo-dev/projectname
  ```

- 在名为env/的子目录中创建一个Python虚拟环境对象：

  ```
  python3 -m venv env
  ```

- 创建一些子目录，如下：

  ```
  mkdir src local bin filestore logs
  ```

  - src/：包含Odoo本身的一个拷贝，以及一些第三方插件项目（我们在下一步中添加了Odoo源码）
  - local/：用于保存你针对具体实例的插件
  - bin/：包含各类帮助可执行shell脚本
  - filestore/：用于文件存储
  - logs/（可选）：用于存储服务日志文件

- 克隆Odoo并安装所需依赖包

  ```
  git clone -b 14.0 --single-branch --depth 1 https://github.com/odoo/odoo.git src/odoo
  env/bin/pip3 install -r src/odoo/requirements.txt
  ```

  - depth用于指定克隆深度，为1即表示只克隆最近一次commit.

- 以bin/odoo保存如下shell脚本

  ```
  #!/bin/sh
  ROOT=$(dirname $0)/..
  PYTHON=$ROOT/env/bin/python3
  ODOO=$ROOT/src/odoo/odoo-bin
  $PYTHON $ODOO -c $ROOT/projectname.cfg "$@"
  exit $?
  ```

- 让该脚本可执行

  ```
  chmod +x bin/odoo
  ```

- 创建一个空的本地模块dummy

  ```
  mkdir -p local/dummy
  touch local/dummy/__init__.py
  echo '{"name": "dummy", "installable": False}' >\
  local/dummy/__manifest__.py
  ```

- 为你的实例生成配置文件：

  ```
  $ bin/odoo --stop-after-init --save \
   --addons-path src/odoo/odoo/addons,src/odoo/addons,local \
   --data-dir filestore
  ```

- 添加一个.gitignore文件，用于告诉GitHub排除这些给定目录，这样Git在提交代码时就会忽略掉这些目录，例如 filestore/, env/, logs/和src/：

  ```
  # dotfiles, with exceptions:
  .*
  !.gitignore
  # python compiled files
  *.py[co]
  # emacs backup files
  *~
  # not tracked subdirectories
  /env/
  /src/
  /filestore/
  /logs/
  ```

- 为这个实例创建一个Git仓库并将已添加的文件添加到Git中

  ```
  $ git init
  $ git add .
  $ git commit -m "initial version of projectname"
  ```

  

我们生成了一个有明确标签目录和独立角色的干净目录结构。我们使用了不同的目录来存储如下内容：

- 由其它人所维护的代码（src/中）
- 本地相关的具体代码
- 实例的文件存储(filestore)

通过为每个项目建一个virtualenv环境，我们可以确保该项目的依赖文件不会与其它项目的依赖产生冲突，这些项目你可能运行着不同的Odoo版本或使用了不同的第三方插件模块，这将需要不同版本的Python依赖。当然也会带来一部分磁盘空间的开销。

以类似的方式，通过为我们不同的项目使用不同的Odoo拷贝以及第三方插件模块，我们可以让每个项目单独的进行演化并仅在需要时在这些实例上安装更新，因此也减少了引入回退的风险。

bin/odoo允许我们不用记住各个路径或激活虚拟环境就可以运行服务。这还为我们设置了配置文件。你可以在其中添加其它脚本来协助日常工作。例如，可以添加一个脚本来检查运行实例所需的第三方项目。

有关配置文件，我们仅展示了这里需要设置的最小化选项，但很明显可以做更多设置，例如数据库名、数据库过滤器或项目所监听的端口。有关这一话题的更多信息，请参见[第一章 安装Odoo开发环境](https://alanhou.org/odoo-14-installing-the-odoo-development-environment/)。

最后，通过在Git仓库中管理所有这些，在不同的电脑上复制这一设置及在团队中分享开发内容变得相当容易。

> **📝**加速贴士
>
> 要加速项目的创建，可以创建一个包含空结构的模板仓库，并为每个新项目复制（fork）该仓库。这会省却你重新输入bin/odoo脚本、.gitignore及其它所需模板文件（持续集成配置、README.md、ChangeLog等等）所花费的时间。

