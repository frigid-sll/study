##### 从XML文件中删除记录

在前面的小节中，我们学习了如何通过XML文件创建或更新记录。有时，对依赖的模块，会希望要删除此前创建的记录。这可以通过`<delete>`标签实现。



##### 准备工作

在这一节中，我们将通过XML文件添加一些分类，然后删除它们。在真实场景中，会从另一个模块中创建这一记录。但为进行简化，我们将在相同的 XML 文件中添加一些分类，如下：

```xml
<record id="book_category_to_delete" model="library.book.category">
  <field name="name">Test Category</field>
</record>
<record id="book_category_not_delete" model="library.book.category">
  <field name="name">Test Category 2</field>
</record>
```



##### 如何实现…

有两种方式从XML文件中删除记录：

- 通过此前创建记录的 XML ID：

  ```xml
  <delete model="library.book.category" id="book_category_to_delete"/>
  ```

- 通过搜索域：

  ```xml
  <delete model="library.book.category" search="[('name', 'ilike', 'Test')]"/>
  ```

  

##### data.xml最终为：

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<odoo noupdate="1">
    <record id="res_partner_packt" model="res.partner">
        <field name="name">Packt Publishing</field>
        <field name="city">Birmingham</field>
        <field name="country_id" ref="base.uk"/>
    </record>

    <record id="book_category_all" model="library.book.category" forcecreate="False">
        <field name="name">All books</field>
    </record>

    <!-- 待删除的临时分类，真实场景中会在其它模块中创建 -->
    <record id="book_category_to_delete" model="library.book.category">
        <field name="name">Test Category</field>
    </record>
    <record id="book_category_not_delete" model="library.book.category">
        <field name="name">Test Category 2</field>
    </record>

    <delete model="library.book.category" id="book_category_to_delete"/>
    <!-- 可使用搜索域来删除多条记录 -->
      <!-- <delete model="library.book.category" search="[('name', 'ilike', 'Test Category')]"/>-->
</odoo>
```



##### 运行原理…

你将需要使用`<delete>`标签。要从模型中删除记录，需要在model属性中提供模型的名称。这是一个必填的属性。

在第一个方法中，需要提供此前从另一个模块数据文件中创建记录的XML ID。在模块的安装过程中，Odoo会尝试查找该记录。如果以给定XML ID查找到了记录，会删除该记录，否则会抛出一个错误。可以仅删除通过XML文件创建的记录（或带有XML ID的记录）。

在第二个方法中，需要在domain属性中传递作用域。在模块的安装过程中，Odoo会通过该域搜索记录。如果查找到记录，则进行删除。如果给定域没有匹配到任何记录的话该选项不会抛出异常。使用该选项时要极其小心，因为搜索选项会删除所有匹配域的记录，而导致它会删除用户的数据。

- 只会删除在data.xml中创建的数据，不会删除在别处创建的数据

> ⚠️**警告：**在Odoo很少使用<delete>，因为它很危险。如果使用不慎，可能会导致系统崩溃。尽可能避免使用它。