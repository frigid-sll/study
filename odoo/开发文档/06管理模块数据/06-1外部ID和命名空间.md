##### 使用外部ID和命名空间

我们将在已有记录中进行写入来演示如何使用跨模块引用：

- 更新my_library模块的声明文件，注册数据文件如下

  ```
  'data': [
    'data/data.xml',
  ],
  ```

- 在`library.book`模型中新建一本书：

  ```xml
  <record id="book_cookbook" model="library.book">
      <field name="name">Odoo 14 Development Cookbook</field>
  </record>
  ```

- 修改主公司的名称

  ```xml
  <record id="base.main_company" model="res.company">
      <field name="name">Packt Publishing</field>
  </record>
  ```

- 最终data/data.xml内容为：

  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <odoo>
      <record id="base.main_company" model="res.company">
          <field name="name">Packt Publishing</field>
      </record>
  
      <record id="book_cookbook" model="library.book">
          <field name="name">Odoo 14 Development Cookbook</field>
      </record>
  </odoo>
  ```

- 安装该模块来应用修改。在安装后，会创建一条新的图书记录***Odoo 14 Development Cookbook*** 并会将公司重命名为**Packt Publishing**。

**译者注：**公司名称可点击 Settings 进行查看，仅执行更新仅会添加图书记录，修改公司的名称要求重新安装该模块

![Odoo 14开发者指南第六章 管理模块数据](https://i.cdnl.ink/homepage/wp-content/uploads/2021/01/2021011003550987.jpg)



##### 运行原理…

XML ID是一个引用数据库中某记录的字符串。ID本身是ir.model.data模型中的记录。

这一模型包含声明XML ID的模块名、ID字符串、所引用模型和所引用ID等。

每次在`<record>`标签中使用XML ID时，Odoo会检查该字符串是否带有命名空间（即它是否只包含一个点标记）

- 如果不带有，会添加当前模块名作为命名空间。然后，它查找ir.model.data中是否有指定名称的记录。
  - 若有，所列出字段会执行一个UPDATE语句。
  - 若没有，则执行一条CREATE语句。这样就可以像前面那样在记录已存在时添加部分数据。

##### 示例解释

- 本节中的第一个示例中，记录有一个 ID book_cookbook。

  - 因其不带有命名空间，最终的外部ID模块名为：my_library.book_cookbook。

  - 然后Odoo会尝试查找my_library.book_cookbook记录。

  - 因为Odoo还没有这个外部ID的记录，它会在library.book模型中生成一条新记录。

- 第二个示例中，我们使用了主公司的外部ID，即base.main_company。

  - 命名空间表明，它从base模块中进行的加载。

  - 因这个外部ID已存在，Odoo不会创建一条记录

  - 而是执行write (UPDATE)操作，这样公司名就会变为Packt Publishing。



> 📝**重要提示**：
>
> 除由其它模块定义的记录修改外，部分数据的一个广泛应用是使用快捷元素来以便捷的方式来创建记录并在记录中写入字段，这个快捷元素并不提供支持：

```xml
<act_window id="my_action" name="My action" model="res.partner" />
<record id="my_action" model="ir.actions.act_window">
  <field name="auto_search" eval="False" />
</record>
```



ref函数，在本章中*使用XML文件加载数据*一节中也会使用到，如果符合条件的话会以命名空间添加当前模块，但如果生成的XML ID尚不存在的话会抛出错误。如果没添加命名空间对于 id 属性也同样如此。

> 📝**小贴士：**如果希望查看所有外部标识符的列表的话，启动开发者模式，然后打开菜单访问Settings > Technical > Sequence & Identifiers > External Identifiers。



##### 扩展知识…

迟早你会需要在Python代码中通过XML ID访问记录。这时使用`self.env.ref()`函数。它返回所引用记录的浏览记录（记录集）。注意在这里要保持传入完整的XML ID。一个完整XML ID的示例为：<module_name>.<record_id>。

可以在用户界面中看到任意记录的XML ID。这要求启动Odoo的开发者模式。

参见[第一章 安装Odoo开发环境](https://alanhou.org/odoo-14-installing-the-odoo-development-environment/)来在 Odoo 中启动开发者模式。在激活了开发者模式之后，打开你希望查看XML ID的记录的表单视图。会在顶栏中看到一个调试图标。在该菜单中，点击View Metadata选项。