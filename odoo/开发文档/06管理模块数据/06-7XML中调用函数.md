##### 在XML文件中调用函数

可以通过XML文件创建各种类型的记录，但有时生成包含一些业务逻辑的数据会很困难。你可能会希望在用户在生产环境中安装依赖模块时修改记录。

例如，假设你想要创建一个模块来在线展示书籍。

my_library模块已有图片封面字段。设想在新的模块中你实现了缩减减图像大小以及在新的缩略图字段中存储它的逻辑。现在在用户安装这一模块时，可能已有图书和图像了。不太可能在XML文件中通过`<record>`标签生成缩略图。在这种情况下，可以通过`<function>`标签调用模型方法。

> **译者注：**本节中如想反复测试，请先将 noupdate 删除或置为0
>
> 此外对于部分设置了 noupdate的， 如想继续测试更新可访问Technical > Sequences and Identifiers > External Identifiers，找到对应的记录，取消 noupdate 的勾选再次测试。



##### 如何实现…

这一节中，我们将使用前一小节的代码。作为示例，我们将已有图书价格增加$10 USD。注意按照公司配置你可能使用的是其它币种。

按照如下步骤通过XML文件调用Python方法：

- 在library.book模型中添加_update_book_price()方法：

  ```python
  @api.model
  def _update_book_price(self):
    all_books = self.search([])
    for book in all_books:
      book.cost_price += 10
  ```

- 在数据XML文件中(data.xml)添加`<function>`

  ```
  <function model="library.book" name="_update_book_price"/>
  ```

  

##### 运行原理…

在第一步中，我们添加了_update_book_price()方法，它搜索所有图书并将它们的价格增加$10 USD。

我们在方法名前加上下划线`_`，是因为它被ORM视作私有，不允许通过RPC调用。

在第二步中，我们使用了`<function>`标签并添加了两个属性：

- model：在其中声明方法的模型名称
- name：想要调用的方法名

在安装这一模块时，_update_book_price()会被调用并且书籍的价格会被加上$10。

📝**重要：**保持为一函数添加noupdate选项。否则，会在每次更新模块时调用它。



##### 扩展知识…

通过`<function>`可以向函数发送参数。假设只想要在某个分类中增加图书的价格并且通过参数发送这一增加的值。

那么，需要创建一个方法来接收分类作为参数，如下：

```python
@api.model
def update_book_price(self, category, amount_to_increase):
  category_books = self.search([('category_id', '=', category.id)])
  for book in category_books:
    book.cost_price += amount_to_increase
```

传递分类和数值作为参数，需要使用eval属性，如下：

```python
<function model="library.book"
  name="update_book_price"
  eval="(ref('category_xml_id'), 20)"/>
```

