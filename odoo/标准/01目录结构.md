#### 模块结构

##### 目录

模块组织在重要的目录中。包含业务逻辑；查看一下应当会了解模块的用途。

- *data/* : 演示和数据xml
- *models/* : 模型定义
- *controllers/* : 包含控制器(HTTP 路由)
- *views/* : 包含视图和模板
- *static/* : 包含网页资源，分离为 *css/, js/, img/, lib/, …*

其它组成模块的可选目录。

- *wizard/* : 重组临时模型(`models.TransientModel`) 及其视图
- *report/* : 包含基于SQL视图的可打印报表和模型。Python对象和XML视图也在该目录中
- *tests/* : 包含Python测试类



##### 文件命名

文件命名对于在odoo插件中快速查找信息非常重要。

本节讲解如何在标准odoo模块中进行文件的命名。作为示例我们使用 [育苗](https://github.com/tivisse/odoodays-2018/tree/master/plant_nursery) 应用。它包含两个主要模型*plant.nursery* 和 *plant.order*。

有关*models*， 通过属于相同主模型的模型组来分离逻辑。每组处于基于主模型命名的给定文件中。如果仅有一个模型，其名称与模块名相同。每个继承模型应放在自己的文件中来有助于理解所受影响的模型。

```
addons/plant_nursery/
|-- models/
|   |-- plant_nursery.py (first main model)
|   |-- plant_order.py (another main model)
|   |-- res_partner.py (inherited Odoo model)
```





有关*security* 和访问权限及规则时应使用两个主要文件。第一个是访问权限应在 `ir.model.access.csv` 文件中进行定义。用户组在`<module>_groups.xml`中进行定义。访问规则在 `<model>_security.xml`中定义。

```
addons/plant_nursery/
|-- security/
|   |-- ir.model.access.csv
|   |-- plant_nusery_groups.xml
|   |-- plant_nusery_security.xml
|   |-- plant_order_security.xml
```



有关 *views*, 后台视图应类似模型进行分离并由`_views.xml`进行后缀。后台视图有列表、表单、看板、活动、图表、透视表… 视图。 要缓解视图中按模型的分离不关联具体动作的主菜单可提取为可选的 `<module>_menus.xml` 文件。模板 (QWeb页面主要用于门户/网站展示)和资源包 (JS 和 CSS资源的导入) 放在单独的文件中。它们分别为`<model>_templates.xml` 和 `assets.xml` 文件。

```
addons/plant_nursery/
|-- views/
|   | -- assets.xml (import of JS / CSS)
|   | -- plant_nursery_menus.xml (optional definition of main menus)
|   | -- plant_nursery_views.xml (backend views)
|   | -- plant_nursery_templates.xml (portal templates)
|   | -- plant_order_views.xml
|   | -- plant_order_templates.xml
|   | -- res_partner_views.xml
```



有关*data*, 按照用途(演示或数据)和主模型分离它们。用户名将为由`_demo.xml` 或 `_data.xml`后缀的main_model名称。例如具有带有演示和数据的应用，针对与mail模型相关的主模型及子类型、活动和邮件模板：

```
addons/plant_nursery/
|-- data/
|   |-- plant_nursery_data.xml
|   |-- plant_nursery_demo.xml
|   |-- mail_data.xml
```



有关*controllers*, 通常属于单个控制器的所有控制器包含在一个名为`<module_name>.py`的文件中。Odoo中老的惯例是将该文件命名为`main.py` ，但现在认为已过时。如果需要从另一个模块中继承已有控制器应在 `<inherited_module_name>.py`中进行。例如，在应用中添加门户控制器在`portal.py`中完成。

```
addons/plant_nursery/
|-- controllers/
|   |-- plant_nursery.py
|   |-- portal.py (inheriting portal/controllers/portal.py)
|   |-- main.py (deprecated, replaced by plant_nursery.py)
```



有关*静态文件*, Javascript文件全局遵循与python模型相同的逻辑。每个组件应使用一个有意义的名称放在自己的文件中。 例如，活动控件位于mail模块的`activity.js` 中。也可以创建子目录来架构‘package’ (参见web模块获取更多详情)。相同的逻辑应对JS控件的模板（静态XML文件）及它们的样式（scss文件）进行应用。不要在Odoo之外链接数据 (图像、库)：不要使用图片的URL而又在基代码中拷贝它。

有关*向导*, 命名惯例与python模型相同： `<transient>.py` 和 `<transient>_views.xml`。两者都放在wizard目录中。来自老的odoo应用的w 命名对临时模型使用wizard关键字。

```
addons/plant_nursery/
|-- wizard/
|   |-- make_plant_order.py
|   |-- make_plant_order_views.xml
```



有关*统计报表* python / SQL视图和经典视图命名如下：

```
addons/plant_nursery/
|-- report/
|   |-- plant_order_report.py
|   |-- plant_order_report_views.xml
```



有关*可打印报表* 主要包含数据准备和Qweb模板命名如下：

```
addons/plant_nursery/
|-- report/
|   |-- plant_order_reports.xml (report actions, paperformat, ...)
|   |-- plant_order_templates.xml (xml report templates)
```



因此我们的Odoo模块的完整目录树如下：

```
addons/plant_nursery/
|-- __init__.py
|-- __manifest__.py
|-- controllers/
|   |-- __init__.py
|   |-- plant_nursery.py
|   |-- portal.py
|-- data/
|   |-- plant_nursery_data.xml
|   |-- plant_nursery_demo.xml
|   |-- mail_data.xml
|-- models/
|   |-- __init__.py
|   |-- plant_nursery.py
|   |-- plant_order.py
|   |-- res_partner.py
|-- report/
|   |-- __init__.py
|   |-- plant_order_report.py
|   |-- plant_order_report_views.xml
|   |-- plant_order_reports.xml (report actions, paperformat, ...)
|   |-- plant_order_templates.xml (xml report templates)
|-- security/
|   |-- ir.model.access.csv
|   |-- plant_nusery_groups.xml
|   |-- plant_nusery_security.xml
|   |-- plant_order_security.xml
|-- static/
|   |-- img/
|   |   |-- my_little_kitten.png
|   |   |-- troll.jpg
|   |-- lib/
|   |   |-- external_lib/
|   |-- src/
|   |   |-- js/
|   |   |   |-- widget_a.js
|   |   |   |-- widget_b.js
|   |   |-- scss/
|   |   |   |-- widget_a.scss
|   |   |   |-- widget_b.scss
|   |   |-- xml/
|   |   |   |-- widget_a.xml
|   |   |   |-- widget_a.xml
|-- views/
|   |-- assets.xml
|   |-- plant_nursery_menus.xml
|   |-- plant_nursery_views.xml
|   |-- plant_nursery_templates.xml
|   |-- plant_order_views.xml
|   |-- plant_order_templates.xml
|   |-- res_partner_views.xml
|-- wizard/
|   |--make_plant_order.py
|   |--make_plant_order_views.xml
```

##### ⚠️警告

使用正确的文件权限： 文件夹755 及文件 644。